<!DOCTYPE html>
<html lang="fr"><head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<style> /* set the CSS */
		
		path { 
		stroke: steelblue;
		stroke-width: 2;
		fill: none;
		}
		
		.axis path,
		.axis line {
		fill: none;
		stroke: grey;
		stroke-width: 1;
		shape-rendering: crispEdges;
		}
		
		svg{
		text-align : center;
		}
		
	</style>
	<meta charset="utf-8">
	<title>Cosmograve</title>
	<link rel="stylesheet" href="css/style.css">
	<script src="lib/jquery-1.12.3.min.js"></script>
	<script src="lib/numeric-1.js"></script>
	<script src="lib/math.js"></script>
	<script src="lib/d3.js"></script>
	<script>
		function integrale(borneInf, borneSup, nbreInterval, callback, omegam0, omegalambda0, Or){
			var i = 0;
			var sommeInf = 0;
			var sommeSup = 0;
			var somme = 0;
			var interval = (borneSup - borneInf) / nbreInterval;
			for ( i = 0; i < nbreInterval; i++)
			{
				sommeInf += callback(borneInf + i * interval, omegam0, omegalambda0, Or) * interval;
			}
			for ( i = 1; i < nbreInterval + 1; i++)
			{
				sommeSup += callback(borneInf + i * interval, omegam0, omegalambda0, Or) * interval;
			}
			somme = (sommeInf + sommeSup) / 2;
			return somme;
		}
		
		function fonction_integrale(x, omegam0, omegalambda0, Or){
			return (1/((1+x) * Math.sqrt(Or*Math.pow(1+x, 4) + omegam0*Math.pow(1+x, 3) - (omegalambda0 + Or + omegam0 - 1)*Math.pow(1+x, 2) + omegalambda0)));
			//return (x*x);
		}
		</script><script>
		ymoinsrunge = [0,0]; //variable necessaire pour eviter une recurence longue
		ymoinsrungederiv = [0,0];
		k = [0,0,0,0];
		j = [0,0,0,0];
		
		function fonction(x){
			return (-Or/x*x*x)-((0.5*omegam0)/x*x)+omegalambda0*x;
		}
		
		function valeurtest4(n, n2){ // 4 valeur test pour Runge-Kutta
			k[0] = (fonction(n)*pas);
			j[0] = n2*pas;
			
			k[1] = (fonction(n+(1./2)*j[0])*pas);
			j[1] =(n2+k[0]/2)*pas;
			
			k[2] = (fonction(n+(1./2)*j[1])*pas);
			j[2] =(n2+k[1]/2)*pas;
			
			k[3] = (fonction(n+(1./2)*j[2])*pas);
			j[3] =(n2+k[2])*pas;
		}
		
		function rungekutta(n){ // Fonction Runge-Kutta
			if (n == 0){
				ymoinsrunge[0] = ymoinsrunge[1] = 1; // valeur initiale
				ymoinsrungederiv[0] = ymoinsrungederiv[1] = 1; // valeur initiale
				return ymoinsrunge[1];
			}else{
				
				ymoinsrunge[1] = (ymoinsrunge[0]+(1./6)*((j[0])+2*(j[1])+2*(j[2])+(j[3]))) // Xn-1+(1./6)*(k1+2*k2+2*k3+k4);
				ymoinsrunge[0] = ymoinsrunge[1];
				
				ymoinsrungederiv[1] = (ymoinsrungederiv[0]+(1./6)*((k[0])+(2*k[1])+(2*k[2])+(k[3]))) // Xn-1+(1./6)*(k1+2*k2+2*k3+k4);
				ymoinsrungederiv[0] = ymoinsrungederiv[1];
				
				valeurtest4(ymoinsrunge[0], ymoinsrungederiv[0]);
				
				return ymoinsrunge[1];
			}
		}
		
		function rungekutta_neg(n){ // Fonction Runge-Kutta
			if (n == 0){
				ymoinsrunge[0] = ymoinsrunge[1] = 1; // valeur initiale
				ymoinsrungederiv[0] = ymoinsrungederiv[1] = 1; // valeur initiale
				return ymoinsrunge[1];
			}else{
				
				ymoinsrunge[1] = (ymoinsrunge[0]-(1./6)*((j[0])+2*(j[1])+2*(j[2])+(j[3]))) // Xn-1+(1./6)*(k1+2*k2+2*k3+k4);
				ymoinsrunge[0] = ymoinsrunge[1];
				
				ymoinsrungederiv[1] = (ymoinsrungederiv[0]-(1./6)*((k[0])+(2*k[1])+(2*k[2])+(k[3]))) // Xn-1+(1./6)*(k1+2*k2+2*k3+k4);
				ymoinsrungederiv[0] = ymoinsrungederiv[1];
				
				valeurtest4(ymoinsrunge[0], ymoinsrungederiv[0]);
				
				return ymoinsrunge[1];
			}
		}
		
		</script><script>
		function range(start, stop, step) {
			if (typeof stop == 'undefined') {
				// one param defined
				stop = start;
				start = 0;
			}
			
			if (typeof step == 'undefined') {
				step = 1;
			}
			
			if ((step > 0 && start >= stop) || (step < 0 && start <= stop)) {
				return [];
			}
			
			var result = [];
			for (var i = start; step > 0 ? i < stop : i > stop; i += step) {
				result.push(i);
			}
			
			return result;
		}
		</script><script>
		function calcul(){   // declaration de la fonction
			var c = 2.99*Math.pow(10, 8);
			var G = 6.67384*Math.pow(10, -11);
			
			var t0 = document.getElementById("T0").value;
			var h0 = document.getElementById("H0").value; 
			omegam0 = Number(document.getElementById("omegam0").value);
			omegalambda0 = Number(document.getElementById("omegalambda0").value);
			var H0parGan = 0;
			
			Or = 0;
			if (document.getElementById("liste").options[2].selected) {
				//Or = 2.59734*Math.pow(10, -40)/(Math.pow(h0/Math.pow(3.085678, 19), 2));
				//Or = (8*Math.PI*G*4*Math.pow(t0, 4))/(3*Math.pow(h0, 2)*Math.pow(c, 2));
				Or=(1.412171e-41)*Math.pow(t0,4)/(3*Math.pow(h0/(3.085678e19),2));
				Or=1.68*Or;
				Or = Or.toExponential();
				} else if (document.getElementById("liste").options[1].selected) {
				Or=(1.412171e-41)*Math.pow(t0,4)/(3*Math.pow(h0/(3.085678e19),2));
				Or = Or.toExponential();
				} else {
			}
			
			omegalambda0 = 1 - omegam0 - Or;
			omegalambda0 = omegalambda0.toExponential();
			
			document.getElementById("resultat_omegar0").innerHTML = Or;
			document.getElementById("resultat_omegarlambda0").innerHTML = omegalambda0;
			
			H0parGan = h0*1.0245974*Math.pow(10, -3);
			
			var age = (1/H0parGan)*integrale(0, 1000, 1000000, fonction_integrale, omegam0, Number(omegalambda0), Number(Or));
			document.getElementById("resultat_ageunivers").innerHTML = age+" Ga";
			
			pas = 0.001;
			var nbri = 400;
			
			i = 0;
			m = 0;
			var x = 0;
			x2 = 0;
			var yrunge = 1;
			var yrunge2 = 1;
			data = [];
			
			while (yrunge2 > 0){
				if(yrunge2<0.01){pas=Math.pow(10,-6);}
				x2 = m*pas;
				yrunge2 = rungekutta_neg(m);
				data.push({date:age+x2/H0parGan,close:yrunge2});
				m--;
			}
			
			pas = 0.001;
			ymoinsrunge = [0,0]; //variable necessaire pour eviter une recurence longue
			ymoinsrungederiv = [0,0];
			k = [0,0,0,0];
			j = [0,0,0,0];
			
			while (yrunge < 5.){ // permet de boucler sur une veleur de reference
				x = i*pas; //position x
				yrunge = rungekutta(i); //position f(x) Runge-Kutta
				data.push({date:age+x/H0parGan,close:yrunge});
				i++;
			}
			
			$('#graphique').empty();
			
			// Set the dimensions of the canvas / graph
				var margin = {top: 30, right: 20, bottom: 30, left: 50},
				width = 700 - margin.left - margin.right,
				height = 450 - margin.top - margin.bottom;
				
				// Set the ranges
				var x = d3.scale.linear().range([0, width]);
				var y = d3.scale.linear().range([height, 0]);
				
				// Define the axes
				var xAxis = d3.svg.axis().scale(x)
				.orient("bottom").ticks(5);
				
				var yAxis = d3.svg.axis().scale(y)
				.orient("left").ticks(5);
				
				// Define the line
				var valueline = d3.svg.line()
				.x(function(d) { return x(d.date); })
				.y(function(d) { return y(d.close); });
				
				// Adds the svg canvas
				var svg = d3.select("#graphique")
				.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				
				//d3.csv("data.csv", function(error, data) {
				data.forEach(function(d) {
					d.date = d.date;
					d.close = +d.close;
				});
				//alert(data);
				// Scale the range of the data
				x.domain(d3.extent(data, function(d) { return d.date; }));
				y.domain([0, d3.max(data, function(d) { return d.close; })]);
				
				// Add the valueline path.
				svg.append("path")
				.attr("class", "line")
				.attr("d", valueline(data));
				
				// Add the X Axis
				svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);
				
				// Add the Y Axis
				svg.append("g")
				.attr("class", "y axis")
				.call(yAxis);
				
				svg.append("text")
				.attr("x", 175)
				.attr("y", -15)
				.attr("dy", ".3em")
				.attr("transform", "rotate(0)")
				.text("Evolution du facteur d'\351chelle r\351duit");
				
				svg.append("text")
				.attr("x", 225)
				.attr("y", 415)
				.attr("dy", ".3em")
				.attr("transform", "rotate(0)")
				.text("t (Ga)");
				
				svg.append("text")
				.attr("x", -150)
				.attr("y", -35)
				.attr("dy", ".3em")
				.attr("transform", "rotate(-90)")
				.text("a (t)");
		}
	</script></head>
	
	<body>
	<div id="temp"></div>
		<form id="parametres" action="/ma-page-de-traitement" method="post">
			<div class="desact_retour">
				<label for="T0">T<sub>0</sub> =</label>
				<input id="T0" value="2.725" maxlength="10" type="text">
			</div>
			<div class="desact_retour">
				<label for="H0">H<sub>0</sub> =</label>
				<input id="H0" value="67.74" maxlength="10" type="text">
			</div>
			<div class="desact_retour">
				<label for="omegam0">O<sub>m0</sub> =</label>
				<input id="omegam0" value="0.3089" maxlength="10" type="text">
			</div>
			<div class="desact_retour">
				<label for="omegalambda0">O<sub>&Lambda;0</sub> =</label>
				<input id="omegalambda0" value="0" maxlength="10" type="text" disabled>
			</div>
			
			<div>
				<select id="liste" name="type" size="1">
					<option selected="selected">Mati&egrave;re et Lambda</option>
					<option>Mati&egrave;re, Lambda et RFC</option>
					<option>Mati&egrave;re, Lambda, RFC et Neutrinos</option>
				</select>
				
				<div class="button, desact_retour" onclick="calcul()">
					<button type="submit">Tracer</button>
				</div>
			</div>
		</form>
		
		<div id="graphique">
			<script>
				// Set the dimensions of the canvas / graph
				var margin = {top: 30, right: 20, bottom: 30, left: 50},
				width = 700 - margin.left - margin.right,
				height = 450 - margin.top - margin.bottom;
				
				// Parse the date / time
				var parseDate = d3.time.format("%d-%b-%y").parse;
				
				// Set the ranges
				var x = d3.time.scale().range([0, width]);
				var y = d3.scale.linear().range([height, 0]);
				
				// Define the axes
				var xAxis = d3.svg.axis().scale(x)
				.orient("bottom").ticks(5);
				
				var yAxis = d3.svg.axis().scale(y)
				.orient("left").ticks(5);
				
				// Define the line
				var valueline = d3.svg.line()
				.x(function(d) { return x(d.date); })
				.y(function(d) { return y(d.close); });
				
				// Adds the svg canvas
				var svg = d3.select("#graphique")
				.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				
				// Get the data
				data = [
				{date:"1-May-12",close:58.13},
				{date:"30-Apr-12",close:53.98}
				];
				
				//d3.csv("data.csv", function(error, data) {
				data.forEach(function(d) {
					d.date = parseDate(d.date);
					d.close = +d.close;
				});
				
				// Scale the range of the data
				x.domain(d3.extent(data, function(d) { return d.date; }));
				y.domain([0, d3.max(data, function(d) { return d.close; })]);
				
				// Add the valueline path.
				svg.append("path")
				.attr("class", "line")
				.attr("d", valueline(data));
				
				// Add the X Axis
				svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);
				
				// Add the Y Axis
				svg.append("g")
				.attr("class", "y axis")
				.call(yAxis);
				
				svg.append("text")
				.attr("x", 175)
				.attr("y", -15)
				.attr("dy", ".3em")
				.attr("transform", "rotate(0)")
				.text("Evolution du facteur d'\351chelle r\351duit");
				
				svg.append("text")
				.attr("x", 225)
				.attr("y", 415)
				.attr("dy", ".3em")
				.attr("transform", "rotate(0)")
				.text("t (Ga)");
				
				svg.append("text")
				.attr("x", -150)
				.attr("y", -35)
				.attr("dy", ".3em")
				.attr("transform", "rotate(-90)")
				.text("a (t)");
			</script>
		</div>
		
		<div>
			&Omega;<sub>r0</sub> = <span id="resultat_omegar0"></span>
			&Omega;<sub>&Lambda;0</sub> = <span id="resultat_omegarlambda0"></span>
			Age de l'univers = <span id="resultat_ageunivers"></span>
			
		</div>
		
	</body></html>					